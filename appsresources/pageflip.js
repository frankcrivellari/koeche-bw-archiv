var x5e=null;if(typeof x5engine!="undefined"){x5e=x5engine}(function($,x5engine){"use strict";$.fn.pageflip=function(options){var _options=$.extend({width:800,height:600,autoplay:false,interval:2e3,loadingImg:null,circle:false,showCounter:false,controlbar:null,medias:[],fullscreen:false,fullscreenmedias:[]},options);var _self=this,_height=0,_width=0,_images=[],_currentIndex=0,_autoPlay=_options.autoplay,_animating=false,_loader=_options.loadingImg?$('<img src="'+_options.loadingImg+'" style="z-index: 5;" />'):null,_loaderTimeout,_animationTimeout,_useCSS3,_loadedImages=0;_useCSS3=function(prop){var div=document.createElement("div"),vendors=["Khtml","Ms","O","Moz","Webkit"],len=5;if(prop in div.style){return prop}prop=prop.replace(/^[a-z]/,function(val){return val.toUpperCase()});while(len--){if(vendors[len]+prop in div.style){return vendors[len]+prop}}return false}("transform");var _doFlipCSS3=function(direction){if(_animating){return}_animating=true;var curImg=_options.medias[_currentIndex],nextIndex,nextImg,curPage1,curPage2,nextPage1,nextPage2,imagesReady=0,end=_currentIndex==_options.medias.length-1,start=_currentIndex===0,onImagesReady=function(){var middle=_options.circle||direction>0&&!end||direction<0&&!start,reqImagesNumber=middle?4:2;if(++imagesReady==reqImagesNumber){var transitionCount=0;if(_loaderTimeout){clearTimeout(_loaderTimeout)}if(_loader){_loader.detach()}_self.find(".page-prev").on("webkitTransitionEnd.pageflip otransitionend.pageflip msTransitionEnd.pageflip transitionend.pageflip",function(e){if(++transitionCount==(e.type=="webkitTransitionEnd"||middle?2:1)){if(middle){_currentIndex=nextIndex}(nextPage2?nextPage2:curPage2).after(_images[_currentIndex]);_self.find("img").first().detach();_self.find("img").css("visibility","visible");_self.find(".page").remove();_animating=false;if(_autoPlay&&middle){_startAutoplay()}if(_options.showCounter){_attachCounter(_self,_currentIndex+1,_options.medias.length)}}});_self.find(".page").css("visibility","visible");if(!_options.circle){if(start&&direction<0){_self.find(".page").first().css("visibility","hidden")}else if(end&&direction>0){_self.find(".page").last().css("visibility","hidden")}_self.find("img").first().css("visibility","hidden")}setTimeout(function(){if(_options.showCounter){_detachCounter(_self)}_self.find(".page-prev").toggleClass("page-prev-position0").toggleClass("page-prev-position1");_self.find(".page-next").toggleClass("page-next-position0").toggleClass("page-next-position1");if(!middle){setTimeout(function(){_self.find(".page-prev").toggleClass("page-prev-position0").toggleClass("page-prev-position1");_self.find(".page-next").toggleClass("page-next-position0").toggleClass("page-next-position1")},250)}},50)}};nextIndex=_currentIndex+direction;if(nextIndex<0){nextIndex=_images.length-1}else if(nextIndex>=_images.length){nextIndex=0}nextImg=_options.medias[nextIndex];curPage1=$('<div class="page" style="z-index: 2"><img /></div>');curPage1.find("img").width(Math.floor((direction>0?curImg:nextImg).width)).height(Math.floor((direction>0?curImg:nextImg).height)).css({left:Math.floor((_options.width-(direction>0?curImg:nextImg).width)/2)+"px",top:Math.floor((_options.height-(direction>0?curImg:nextImg).height)/2)+"px"});curPage2=$('<div class="page page-prev page-prev-position'+(direction>0?"0":"1")+'" style="z-index: 3; left: 50%;"><img /><div class="shadow"></div></div>');if(_options.showCounter){_attachCounter(curPage2,(direction>0?_currentIndex:nextIndex)+1,_options.medias.length)}curPage2.find("img").width(Math.floor((direction>0?curImg:nextImg).width)).height(Math.floor((direction>0?curImg:nextImg).height)).css({left:"auto",right:Math.floor((_options.width-(direction>0?curImg:nextImg).width)/2)+"px",top:Math.floor((_options.height-(direction>0?curImg:nextImg).height)/2)+"px"});nextPage1=$('<div class="page page-next page-next-position'+(direction>0?"0":"1")+'" style="z-index: 3"><img /><div class="shadow"></div></div>');nextPage1.find("img").width(Math.floor((direction>0?nextImg:curImg).width)).height(Math.floor((direction>0?nextImg:curImg).height)).css({left:Math.floor((_options.width-(direction>0?nextImg:curImg).width)/2)+"px",top:Math.floor((_options.height-(direction>0?nextImg:curImg).height)/2)+"px"});nextPage2=$('<div class="page" style="z-index: 2; left: 50%;"><img /></div>');nextPage2.find("img").width(Math.floor((direction>0?nextImg:curImg).width)).height(Math.floor((direction>0?nextImg:curImg).height)).css({left:"auto",right:Math.floor((_options.width-(direction>0?nextImg:curImg).width)/2)+"px",top:Math.floor((_options.height-(direction>0?nextImg:curImg).height)/2)+"px"});if(_options.showCounter){_attachCounter(nextPage2,(direction<0?_currentIndex:nextIndex)+1,_options.medias.length)}_self.find("img").after(curPage1);curPage1.after(curPage2);curPage2.after(nextPage1);nextPage1.after(nextPage2);_self.find(".page").css({visibility:"hidden","background-color":_self.css("background-color")}).find("img").on("load.pageflip",onImagesReady);curPage1.find("img").attr("src",(direction>0?curImg:nextImg).url);curPage2.find("img").attr("src",(direction>0?curImg:nextImg).url);nextPage1.find("img").attr("src",(direction>0?nextImg:curImg).url);nextPage2.find("img").attr("src",(direction>0?nextImg:curImg).url);_loaderTimeout=setTimeout(function(){if(_loader){_self.append(_loader.css({left:Math.floor((_options.width-32)/2)+"px",top:Math.floor((_options.height-32)/2)+"px"}))}},250)};var _attachCounter=function(target,index,total){target.append('<div class="counter" style="background-color: '+_self.css("background-color")+'">'+index+"/"+total+"</div>")};var _detachCounter=function(target){target.children(".counter").remove()};var _doFlipFade=function(direction){if(_animating){return}var end=_currentIndex==_options.medias.length-1,start=_currentIndex===0;if(!_options.circle&&(end&&direction>0||start&&direction<0)){return}_animating=true;var nextIndex=_currentIndex+direction;if(nextIndex<0){nextIndex=_images.length-1}else if(nextIndex>=_images.length){nextIndex=0}var nextImg=_options.medias[nextIndex];var img=$("<img />");img.hide();_self.find("img").first().after(img);img.on("load.pageflip",function(){if(_loaderTimeout){clearTimeout(_loaderTimeout)}if(_loader){_loader.detach()}img.width(Math.floor(nextImg.width)).height(Math.floor(nextImg.height)).css({position:"absolute",left:Math.floor((_options.width-nextImg.width)/2),top:Math.floor((_options.height-nextImg.height)/2)}).fadeIn(250,function(){_currentIndex=nextIndex;_animating=false;if(_options.showCounter){_detachCounter(_self);_attachCounter(_self,_currentIndex+1,_options.medias.length)}});_self.find("img").first().fadeOut(250,function(){$(this).remove()})}).attr("src",nextImg.url)};var _startAutoplay=function(){_animationTimeout=setTimeout(function(){_transition(1)},_options.interval)};var _transition=function(direction){if(_useCSS3){_doFlipCSS3(direction)}else{_doFlipFade(direction)}};_self.addClass("pageflip-container").width(_options.width).height(_options.height).css({"background-image":"url('"+_options.loadingImg+"')","background-repeat":"no-repeat","background-position":"center center"});for(var i=0;i<_options.medias.length;i++){var img=$("<img />").width(_options.medias[i].width).height(_options.medias[i].height).css({left:Math.floor((_options.width-_options.medias[i].width)/2)+"px",top:Math.floor((_options.height-_options.medias[i].height)/2)+"px"}).on("load.pageflip",function(){var $this=$(this);if($this.attr("data-index")*1==0){$this.hide();_self.css("background-image","none").append($this);$this.fadeIn(250)}}).attr("data-index",i).attr("src",_options.medias[i].url);_images.push(img)}if(_options.controls){$(_options.controls).on("click.pageflip",".btn-prev",function(){_autoPlay=false;_transition(-1)}).on("click.pageflip",".btn-next",function(){_autoPlay=false;_transition(1)}).on("click.pageflip",".btn-fullscreen",function(){if(_options.fullscreenmedias.length>0){x5engine.imShowBox({media:_options.fullscreenmedias},_currentIndex,_self)}})}else{_self.on("click.pageflip",function(e){var positionX=e.pageX-_self.offset().left;_autoPlay=false;_transition(positionX>_options.width/3?1:-1)})}if(_options.autoplay){_startAutoplay()}if(_options.showCounter){_attachCounter(_self,_currentIndex+1,_options.medias.length)}return{disable:function(){clearTimeout(_animationTimeout);_self.empty();_self.off(".pageflip");if(_options.controls){$(_options.controls).off(".pageflip")}}}}})($,x5e);
