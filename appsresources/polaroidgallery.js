!function(o){"use strict";o.fn.polaroidgallery=function(e){for(var i=o.extend({width:800,height:600,polaroidSize:100,backgroundColor:"#FFFFFF",showbox:!0,medias:[]},e),a=o(this),t=[],r=function(){var e,r,d,n,p,l,h=o(this),s=o('<div class="polaroid-wrapper"/ style="background-color: '+i.backgroundColor+';">'),f=Math.floor(60*Math.random()-30),g=!1,c=-1,u=-1,m=new Date,x=!1;s.width(i.polaroidSize).append('<div class="polaroid-gradient" />').append('<div class="polaroid-image" role="img"/>'),s.find(".polaroid-image").attr("data-index",h.attr("data-index")).css({"background-image":"url('"+h.attr("src")+"')"}).width(i.polaroidSize).height(4*i.polaroidSize/5),s.fadeOut(0),a.append(s);var w=function(){var o=function(o,e){for(var a=0;a<t.length;a++){var r=.8*i.polaroidSize,d=t[a].top-r,n=t[a].top+r,p=t[a].left-r,l=t[a].left+r;if(o>=d&&o<=n&&e>=p&&e<=l)return!0}return!1},e=0,a=0,r=0;do{a=i.polaroidSize/2+Math.floor(Math.random()*(i.height-2*i.polaroidSize)),r=i.polaroidSize/2+Math.floor(Math.random()*(i.width-2*i.polaroidSize))}while(o(a,r)&&++e<2*i.medias.length);if(o(a,r)){var d,n=i.polaroidSize/3;do{d=i.polaroidSize/3;do{if(!o(n,d))return{top:n,left:d};d+=i.polaroidSize/6}while(d<i.width-2*i.polaroidSize);n+=i.polaroidSize/6}while(n<i.height-2*i.polaroidSize)}return{top:a,left:r}}();t.push(w),s.fadeOut(0).css({top:w.top,left:w.left,"padding-top":Math.floor(.03*i.polaroidSize)+"px","padding-left":Math.floor(.03*i.polaroidSize)+"px","padding-right":Math.floor(.03*i.polaroidSize)+"px","padding-bottom":Math.floor(.11*i.polaroidSize)+"px",transform:"rotate("+f+"deg)","z-index":1,cursor:i.showbox?"pointer":"default"}).fadeIn(200),a.on("mousemove",(function(o){g&&(x=!0,s.stop(!1,!1).css({left:Math.min(Math.max(10,d+(o.pageX-e)),i.width-s.outerWidth()),top:Math.min(Math.max(10,n+(o.pageY-r)),i.height-s.outerHeight())}),0!=c&&0!=u&&(c!=e||u!=r)&&(p=c-o.pageX,l=u-o.pageY),c=o.pageX,u=o.pageY,m=new Date)})).on("mouseleave mouseup",(function(e){o.extend(o.easing,{polaroidSwing:function(o,e,i,a,t){return e==t?i+a:a*(1-Math.pow(2,-10*e/t))+i}}),g&&(0!=l||0!=p)&&(new Date).getTime()-m.getTime()<100&&s.animate({left:Math.min(Math.max(10,1*s.css("left").replace(/px/,"")-3*p),i.width-s.outerWidth()),top:Math.min(Math.max(10,1*s.css("top").replace(/px/,"")-3*l),i.height-s.outerHeight())},400,"polaroidSwing"),l=p=0,c=u=0,g=!1})),s.on("mousedown",(function(i){g=!0,x=!1,e=i.pageX,r=i.pageY,d=1*s.css("left").replace(/px/,""),n=1*s.css("top").replace(/px/,"");var t=0;a.find(".polaroid-wrapper").each((function(){t=Math.max(t,1*o(this).css("z-index"))})),1*s.css("z-index")<=t&&s.css("z-index",t+1)})).on("click",(function(){i.showbox&&"undefined"!=typeof x5engine&&!x&&x5engine.imShowBox({media:i.medias},1*o(this).find(".polaroid-image").attr("data-index"),o(this).find(".polaroid-image"))})).on("dragstart",(function(o){return o.preventDefault(),!1}))},d=0;d<i.medias.length;d++)o('<img data-index="'+d+'" />').on("load",r).attr("src",i.medias[d].thumb)}}($);